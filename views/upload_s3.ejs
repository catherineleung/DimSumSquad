  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="icon" href="../../favicon.ico"> -->

    <title>SumComics</title>

    <!-- Bootstrap core, IE10 viewport hack, and custom styles-->
    <link href="/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bootstrap/docs/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <link href="/bootstrap/docs/examples/navbar-static-top/navbar-static-top.css" rel="stylesheet">
    <script src="/bootstrap/docs/assets/js/ie-emulation-modes-warning.js"></script>

  </head>

  <body>

    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="./"><span class="glyphicon glyphicon-heart"></span> DimSumSquad</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/comics">Browse</a></li>
            <li><a href="#">About</a></li>
          </ul>

        <form class="navbar-form navbar-left" role="search" method="get" action="/search">
          <div class="form-group" >
            <input type="text" class="form-control" placeholder="Search" name="query">
          </div>
          <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>
        </form>


          
          <ul class="nav navbar-nav navbar-right">
            <% if (!user) { %>
            <li><a href="/signup">Sign Up</a></li>
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a class="dropdown-toggle" href="#" data-toggle="dropdown">Sign In<strong class="caret"></strong></a>
              <div class="dropdown-menu" style="padding: 20px; padding-bottom: 15px;">
                <!-- Login form here-->
                <form action="/login" method="post" accept-charset="UTF-8">
                  <input id="username" style="margin-bottom: 15px;" type="text" name="email" size="30" placeholder="Username">
                  <input id="password" style="margin-bottom: 15px;" type="password" name="password" size="30" placeholder="Password">
                  <input id="user_remember_me" style="float: left; margin-right: 10px;" type="checkbox" name="remember_me" value="1" />
                  <label class="string optional" for="user_remember_me"> Remember me</label>

                  <input class="btn btn-primary" style="clear: left; width: 100%; height: 32px; font-size: 13px;" type="submit" name="commit" value="Sign In" />
                </form>
              </div>
              <% } else { %>
              <li><a href="/profile">Welcome, <%= user.local.username %>!</a></li>
              <li class="divider-vertical"></li>
              <li><a href="/logout">Log Out</a></li>
              <% } %>
            </ul>


          </div>
        </div>
      </nav>

      <div class="container">
        <div class="col-sm-6 col-sm-offset-3">
          <div class="well">

            <input type="file" id="file_input"/>
            <p id="status">Please select a file</p>
            <!-- <img id="preview" src="/images/default.png" /> -->

            <form method="POST" action="/submit_form/">
              <input type="hidden" id="avatar_url" name="avatar_url" value="/public/default.png" />
              <input type="text" name="username" placeholder="Username" /><br />
              <input type="text" name="full_name" placeholder="Full name" /><br /><br />
              <input type="submit" value="Update profile" />
            </form>

          </div>
        </div>
      </div>


    <!-- Bootstrap core JavaScript and IE10 viewport hack-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../bootstrap/docs/assets/js/ie10-viewport-bug-workaround.js"></script>

    <!-- Functions for AWS S3 upload -->
    <script>

      (function() {
          document.getElementById("file_input").onchange = function(){
              var files = document.getElementById("file_input").files;
              var file = files[0];
              if(file == null){
                  alert("No file selected.");
              }
              else{
                  get_signed_request(file);
              }
          };
      })();

      function get_signed_request(file){
          var xhr = new XMLHttpRequest();
          xhr.open("GET", "/sign_s3?file_name="+file.name+"&file_type="+file.type);
          xhr.onreadystatechange = function(){
              if(xhr.readyState === 4){
                  if(xhr.status === 200){
                      var response = JSON.parse(xhr.responseText);
                      upload_file(file, response.signed_request, response.url);
                  }
                  else{
                      alert("Could not get signed URL.");
                  }
              }
          };
          xhr.send();
      }

      function upload_file(file, signed_request, url){
          var xhr = new XMLHttpRequest();
          xhr.open("PUT", signed_request);
          xhr.setRequestHeader('x-amz-acl', 'public-read');
          xhr.onload = function() {
              if (xhr.status === 200) {
                  document.getElementById("preview").src = url;
                  document.getElementById("avatar_url").value = url;
              }
          };
          xhr.onerror = function() {
              alert("Could not upload file.");
          };
          xhr.send(file);
      }

    </script>

  </body>
  </html>
